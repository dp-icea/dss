<source>
  @type   forward
  port    24224
  bind    0.0.0.0
</source>

<source>
  @type   http
  port    9880
  bind    0.0.0.0
</source>
 
<filter dss.logs>
  @type     parser
  key_name  msg
  format    json
</filter>

<filter kong.logs>
  @type       record_transformer
  remove_keys upstream_status, latencies, upstream_uri
</filter>

<filter dss.logs>
  @type       record_transformer
  remove_keys level, pid, ppid, worker, bind, queue_size, timestamp, version
</filter>

<filter *.logs>
 @type     record_transformer
  <record>
    tag ${tag}
  </record>
</filter>

<match *.logs>
  @type     opensearch
  host      "#{ENV['OPENSEARCH_HOST']}"
  port      "#{ENV['OPENSEARCH_PORT']}"
  user      "#{ENV['USER']}"
  password  "#{ENV['PASSWORD']}"
  scheme                    http
  ssl_verify                false
  index_name                ${tag}
  reconnect_on_error        true
  reload_on_failure         true
</match>
